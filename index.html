<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="theme-color" content="#edae49">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Calendar10">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23edae49'/><rect x='15' y='25' width='70' height='60' rx='8' fill='white' opacity='0.95'/><rect x='15' y='25' width='70' height='18' rx='8' fill='%23545f66'/><circle cx='35' cy='20' r='4' fill='%23545f66'/><circle cx='65' cy='20' r='4' fill='%23545f66'/><rect x='25' y='52' width='12' height='10' rx='2' fill='%23edae49'/><rect x='44' y='52' width='12' height='10' rx='2' fill='%23d0f4ea'/><rect x='63' y='52' width='12' height='10' rx='2' fill='%23d0f4ea'/><rect x='25' y='68' width='12' height='10' rx='2' fill='%23d0f4ea'/><rect x='44' y='68' width='12' height='10' rx='2' fill='%23d0f4ea'/></svg>">
    <title>Calendar10 - Gestiona tus tareas y eventos</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="calendar-navigation.css">
    <link rel="stylesheet" href="agenda-professional.css">
    <link rel="stylesheet" href="header-footer-minimal.css">
    <link rel="stylesheet" href="dark-mode.css">
    <link rel="stylesheet" href="mobile-improvements.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Preload critical resources -->
    <!-- Enhanced modules (EventBus, StateManager, etc.) available in utils/ for future use -->
</head>
<body>
    <header class="header-minimal">
        <div class="header-container">
            <div class="header-left">
                <div class="brand-section">
                    <img src="public/app.png" alt="Calendar10" class="brand-logo">
                    <div class="brand-text">
                        <h1 class="brand-name">Calendar10</h1>
                        <span class="brand-tagline">development by RollanSoft.</span>
                    </div>
                </div>
            </div>
            
            <nav class="header-nav">
                <button id="calendar-btn" class="nav-item">
                    <span class="nav-icon" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>
                    <span class="nav-text">Calendario</span>
                </button>
                <button id="agenda-btn" class="nav-item">
                    <span class="nav-icon" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg></span>
                    <span class="nav-text">Agenda</span>
                </button>
                <button id="weekly-btn" class="nav-item">
                    <span class="nav-icon" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="9" y1="4" x2="9" y2="22"/><line x1="15" y1="4" x2="15" y2="22"/></svg></span>
                    <span class="nav-text">Semanal</span>
                </button>
            </nav>
            
            <div class="header-right">
                <button id="theme-toggle-btn" class="theme-toggle-btn" title="Cambiar tema" aria-label="Alternar modo oscuro">
                    <span id="theme-icon" class="icon"></span>
                </button>
                <div id="user-status" class="user-section">
                    <button id="login-btn" class="user-btn">
                        <span id="login-icon" class="user-icon" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
                        <span id="login-text" class="user-text">Iniciar Sesión</span>
                    </button>
                    <div id="user-info" class="user-info hidden">
                        <img id="user-avatar" alt="Avatar" class="user-avatar hidden">
                        <span id="user-name" class="user-name"></span>
                        <button id="logout-btn" class="logout-btn">Salir</button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div id="calendar-view" class="view">
            <!-- Calendar will be rendered here -->
        </div>
        <div id="agenda-view" class="view hidden">
            <!-- Agenda list will be rendered here -->
        </div>
        <div id="weekly-view" class="view hidden">
            <!-- Weekly view will be rendered here -->
        </div>
    </main>


    <!-- Modal for day tasks -->
    <div id="day-modal" class="modal hidden" aria-hidden="true">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-date">
            <button type="button" class="close-btn" title="Cerrar" aria-label="Cerrar">&times;</button>
            <h3 id="modal-date"></h3>
            <div id="modal-tasks"></div>
            <button type="button" id="add-task-modal-btn">Agregar Tarea</button>
        </div>
    </div>

    <!-- Modal for PDF export -->
    <div id="pdf-export-modal" class="modal hidden" aria-hidden="true">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="pdf-export-title">
            <button type="button" class="close-btn" title="Cerrar" aria-label="Cerrar">&times;</button>
            <h3 id="pdf-export-title"><span class="icon" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></span> Exportar Tareas a PDF</h3>
            <div class="pdf-export-body">
                <h4 class="pdf-section-title">Selecciona el tipo de exportación:</h4>
                <div class="pdf-radio-group">
                    <label class="pdf-radio-label">
                        <input type="radio" name="export-type" value="all" checked>
                        Todas las tareas (ordenadas por fecha)
                    </label>
                    <label class="pdf-radio-label">
                        <input type="radio" name="export-type" value="month">
                        Tareas de un mes específico
                    </label>
                    <label class="pdf-radio-label">
                        <input type="radio" name="export-type" value="custom">
                        Rango de fechas personalizado
                    </label>
                </div>
                
                <div id="month-selection" class="export-option hidden pdf-option-group">
                    <label class="pdf-inline-label">Selecciona el mes:</label>
                    <select id="pdf-month-select" class="pdf-select">
                        <option value="0">Enero</option>
                        <option value="1">Febrero</option>
                        <option value="2">Marzo</option>
                        <option value="3">Abril</option>
                        <option value="4">Mayo</option>
                        <option value="5">Junio</option>
                        <option value="6">Julio</option>
                        <option value="7">Agosto</option>
                        <option value="8">Septiembre</option>
                        <option value="9">Octubre</option>
                        <option value="10">Noviembre</option>
                        <option value="11">Diciembre</option>
                    </select>
                    <select id="pdf-year-select" class="pdf-select">
                        <!-- Populated dynamically by pdf.js -->
                    </select>
                </div>
                
                <div id="custom-range" class="export-option hidden pdf-option-group">
                    <div class="pdf-date-row">
                        <label class="pdf-inline-label">Fecha de inicio:</label>
                        <input type="date" id="start-date" class="pdf-date-input">
                    </div>
                    <div class="pdf-date-row">
                        <label class="pdf-inline-label">Fecha de fin:</label>
                        <input type="date" id="end-date" class="pdf-date-input">
                    </div>
                </div>
                
                <div class="pdf-options-section">
                    <h4 class="pdf-section-title">Opciones adicionales:</h4>
                    <label class="pdf-radio-label">
                        <input type="checkbox" id="include-completed" checked>
                        Incluir tareas completadas
                    </label>
                    <label class="pdf-radio-label">
                        <input type="checkbox" id="include-pending" checked>
                        Incluir tareas pendientes
                    </label>
                </div>
                
                <div class="pdf-actions">
                    <button id="generate-pdf-btn" class="pdf-modal-btn pdf-modal-btn-primary">
                        <span class="icon" aria-hidden="true"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span> Generar PDF
                    </button>
                    <button id="cancel-pdf-btn" class="pdf-modal-btn pdf-modal-btn-secondary">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer-minimal">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <img src="public/loquito.png" alt="Calendar10" class="footer-logo">
                    <span class="footer-name">Calendar10</span>
                </div>
                
                <div class="footer-links">
                    <a href="https://github.com/skillparty" target="_blank" rel="noopener" class="footer-link" title="GitHub">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                    <a href="mailto:skillparty@outlook.com" class="footer-link" title="Email">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                    </a>
                    <a href="tel:+59160344144" class="footer-link" title="Teléfono">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                        </svg>
                    </a>
                </div>
                
                <div class="footer-copyright">
                    <span>&copy; 2026 Calendar10. Todos los derechos reservados.</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        // SW registered
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 3600000); // Every hour
                        
                        // Handle updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available - update immediately
                                    console.log('New SW available, updating...');
                                    newWorker.postMessage({ type: 'skip-waiting' });
                                }
                            });
                        });
                    })
                    .catch(err => {
                        console.error('SW registration failed:', err);
                    });
                    
                // Reload when new service worker takes control
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    window.location.reload();
                });
            });
        }
        
        // Check online/offline status
        window.addEventListener('online', () => {
            // Connection restored
            document.body.classList.remove('offline');
        });
        
        window.addEventListener('offline', () => {
            // Offline mode
            document.body.classList.add('offline');
        });
        
    </script>
    
    <!-- Dark Mode -->
    <script type="module" src="./dark-mode.js"></script>

    <!-- Initialize icons -->
    <script type="module" src="./init-icons.js"></script>
    
    <!-- Main Application Module -->
    <script type="module" src="./app.js"></script>
</body>
</html>